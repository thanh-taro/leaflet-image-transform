L.ImageOverlay.Rotated=L.ImageOverlay.extend({initialize:function(t,a,e,n,i){if(typeof t==="string"){this._url=t}else{this._rawImage=t}this._topLeft=L.latLng(a);this._topRight=L.latLng(e);this._bottomLeft=L.latLng(n);L.setOptions(this,i)},onAdd:function(t){if(!this._image){this._initImage();if(this.options.opacity<1){this._updateOpacity()}}if(this.options.interactive){L.DomUtil.addClass(this._rawImage,"leaflet-interactive");this.addInteractiveTarget(this._rawImage)}t.on("zoomend resetview",this._reset,this);this.getPane().appendChild(this._image);this._reset()},onRemove:function(t){t.off("zoomend resetview",this._reset,this);L.ImageOverlay.prototype.onRemove.call(this,t)},_initImage:function(){var t=this._rawImage;if(this._url){t=L.DomUtil.create("img");t.style.display="none";if(this.options.crossOrigin){t.crossOrigin=""}t.src=this._url;this._rawImage=t}L.DomUtil.addClass(t,"leaflet-image-layer");var a=this._image=L.DomUtil.create("div","leaflet-image-layer "+(this._zoomAnimated?"leaflet-zoom-animated":""));a.appendChild(t);a.onselectstart=L.Util.falseFn;a.onmousemove=L.Util.falseFn;t.onload=function(){this._reset();t.style.display="block";this.fire("load")}.bind(this);t.alt=this.options.alt},_reset:function(){var t=this._image;var a=this._map.latLngToLayerPoint(this._topLeft);var e=this._map.latLngToLayerPoint(this._topRight);var n=this._map.latLngToLayerPoint(this._bottomLeft);var i=e.subtract(a).add(n);var r=L.bounds([a,e,n,i]);var s=r.getSize();var o=a.subtract(r.min);var l=e.subtract(a);var h=n.subtract(a);var d=Math.atan2(l.y,l.x);var _=Math.atan2(h.x,h.y);this._bounds=L.latLngBounds(this._map.layerPointToLatLng(r.min),this._map.layerPointToLatLng(r.max));L.DomUtil.setPosition(t,r.min);t.style.width=s.x+"px";t.style.height=s.y+"px";var g=this._rawImage.width;var u=this._rawImage.height;if(!g||!u){return}var m=a.distanceTo(e)/g*Math.cos(d);var v=a.distanceTo(n)/u*Math.cos(_);this._rawImage.style.transformOrigin="0 0";this._rawImage.style.transform="translate("+o.x+"px, "+o.y+"px)"+"skew("+_+"rad, "+d+"rad) "+"scale("+m+", "+v+") "},reposition:function(t,a,e){this._topLeft=L.latLng(t);this._topRight=L.latLng(a);this._bottomLeft=L.latLng(e);this._reset()}});L.imageOverlay.rotated=function(t,a,e,n,i){return new L.ImageOverlay.Rotated(t,a,e,n,i)};L.ImageOverlayTransform={pointOnLine:function(t,a,e){var n=1+e/t.distanceTo(a);return new L.Point(t.x+(a.x-t.x)*n,t.y+(a.y-t.y)*n)}};L.ImageOverlayTransform.Handle=L.CircleMarker.extend({options:{name:null,radius:5,fillColor:"#ffffff",color:"#202020",fillOpacity:1,weight:2,opacity:1,cursor:"all-scroll",className:"leaflet-image-overlay-transform-handler"},onAdd:function(t){L.CircleMarker.prototype.onAdd.call(this,t);if(this._path){this._path.style.cursor=this.options.cursor}}});L.Handler.ImageOverlayTransform=L.Handler.extend({options:{rotatable:true,scalable:true,draggable:true,bounds:[],topLeftHandler:{name:"topLeftHandler",className:"leaflet-image-overlay-transform-handler transform-handler--scale transform-handler--scale--topleft"},topRightHandler:{name:"topRightHandler",className:"leaflet-image-overlay-transform-handler transform-handler--scale transform-handler--scale--topright"},bottomLeftHandler:{name:"bottomLeftHandler",className:"leaflet-image-overlay-transform-handler transform-handler--scale transform-handler--scale--bottomleft"},bottomRightHandler:{name:"bottomRightHandler",className:"leaflet-image-overlay-transform-handler transform-handler--scale transform-handler--scale--bottomright"},rotationHandler:{name:"rotationHandler",className:"leaflet-image-overlay-transform-handler transform-handler--rotate",cursor:"pointer"},line:{weight:1,opacity:1,dashArray:[3,3],fill:false}},initialize:function(t){this._layer=t;this._map=null;this._polygon=null;this._handlers=[];this._bounds=[]},addHooks:function(){this._updateHandlers();this._map.on("zoomend",this._onMapZoomEnd,this);this._layer.on("mousedown",this._onDragStart,this)},removeHooks:function(){this._removeHandlers();this._map.off("zoomend",this._onMapZoomEnd,this);this._layer.off("mousedown",this._onDragStart,this)},enable:function(t){var a=this._layer;if(t){this.setOptions(t)}if(a._map){this._map=a._map}if(!this.options.bounds||this.options.bounds.length!==4){var e=a._bounds;var n=[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}else{var n=this.options.bounds}this.setBounds(n);return L.Handler.prototype.enable.call(this)},setOptions:function(t){var a=this._enabled;if(a){this.disable()}this.options=L.extend({},L.Handler.ImageOverlayTransform.prototype.options,t);if(a){this.enable()}return this},setBounds:function(t){var a=this._layer;this._bounds=t;a.reposition(t[1],t[2],t[0]);this._updateHandlers();this._calculateCenterPoint()},hideHandlers:function(){this._map.removeLayer(this._handlersGroup)},showHandlers:function(){this._handlersGroup.addTo(this._map)},getRadian:function(){var t=this._map;var a=this._bounds;var e=t.latLngToLayerPoint(a[1]);var n=t.latLngToLayerPoint(a[0]);var i=t.latLngToLayerPoint(a[2]);var r=t.latLngToLayerPoint(a[3]);var s=e.x-n.x;var o=e.y-n.y;var l=i.x-r.x;var h=i.y-r.y;var d=0;if(o<0){d=-Math.atan(s/o)}else{d=Math.PI-Math.atan(l/h)}return d},getCenter:function(){var t=this._map;var a=this._centerPoint;return t.layerPointToLatLng(a)},rotate:function(t){while(t>2*Math.PI){t/=2*Math.PI}var a=this._layer;var e=this._rotateBounds(t);this._bounds=e;a.reposition(e[1],e[2],e[0]);this._updateHandlers()},moveTo:function(t){var a=this._map;var e=this._layer;var n=this._centerPoint;var i=a.latLngToLayerPoint(t);this._centerPoint=i;var r=i.x-n.x;var s=i.y-n.y;if(r||s){var o=this._moveBounds(r,s);this._bounds=o;e.reposition(o[1],o[2],o[0]);this._updateHandlers()}},_onMapZoomEnd:function(){var t=this._map;var a=this._layer;this._updateHandlers();this._centerPoint=t.latLngToLayerPoint(a._bounds.getCenter())},_onDragStart:function(t){var a=this._map;var e=this._layer;var n=this._bounds;this._dragging=true;this._startPoint=t.layerPoint;this._startBounds=this._bounds;e.bringToFront();if(a.dragging.enabled()){a.dragging.disable()}a.on("mousemove",this._onDrag,this).on("mouseup",this._onDragEnd,this);e.fire("dragstart",{bounds:n})},_onDrag:function(t){if(this._dragging){var a=this._map;var e=this._layer;var n=this._startBounds;var i=this._startPoint;var r=t.layerPoint;var s=r.x-i.x;var o=r.y-i.y;if(s||o){var l=this._moveBounds(s,o,n);this._bounds=l;e.reposition(l[1],l[2],l[0]);this._updateHandlers();this._layer.fire("drag",{bounds:l})}}},_onDragEnd:function(){if(this._dragging){var t=this._map;var a=this._layer;var e=this._bounds;t.dragging.enable();delete this._dragging;delete this._startPoint;delete this._startBounds;this._calculateCenterPoint();a.fire("dragend",{bounds:e})}},_onScaleStart:function(t){var a=this._map;var e=this._layer;var n=this._bounds;this._scaling=true;this._startPoint=t.layerPoint;this._startBounds=n;this._activeMarker=t.target;this._radian=this.getRadian();e.bringToFront();if(a.dragging.enabled()){a.dragging.disable()}a.on("mousemove",this._onScale,this).on("mouseup",this._onScaleEnd,this);e.fire("scalestart",{bounds:n})},_onScale:function(t){if(this._scaling){var a=this._startPoint;var e=t.layerPoint;var n=e.x-a.x;var i=e.y-a.y;if(n||i){var r=this._map;var s=this._layer;var o=this._startBounds;var l=o;var h=this._radian;var d=r.layerPointToLatLng(e);var _=this._activeMarker;switch(_.options.name){case"bottomLeftHandler":l[0]=d;var g=this._rotateBounds(-h,l);g[3]=L.latLng(g[0].lat,g[2].lng);g[1]=L.latLng(g[2].lat,g[0].lng);break;case"topLeftHandler":l[1]=d;var g=this._rotateBounds(-h,l);g[0]=L.latLng(g[3].lat,g[1].lng);g[2]=L.latLng(g[1].lat,g[3].lng);break;case"topRightHandler":l[2]=d;var g=this._rotateBounds(-h,l);g[3]=L.latLng(g[0].lat,g[2].lng);g[1]=L.latLng(g[2].lat,g[0].lng);break;case"bottomRightHandler":l[3]=d;var g=this._rotateBounds(-h,l);g[0]=L.latLng(g[3].lat,g[1].lng);g[2]=L.latLng(g[1].lat,g[3].lng);break}l=this._rotateBounds(h,g);this._bounds=l;s.reposition(l[1],l[2],l[0]);this._updateHandlers();s.fire("scale",{bounds:l})}}},_onScaleEnd:function(){if(this._scaling){var t=this._map;var a=this._layer;var e=this._bounds;t.dragging.enable();delete this._scaling;delete this._startPoint;delete this._startBounds;delete this._activeMarker;delete this._radian;this._calculateCenterPoint();a.fire("scaleend",{bounds:e})}},_onRotateStart:function(t){var a=this._map;var e=this._layer;var n=this._bounds;this._rotating=true;this._startPoint=t.layerPoint;this._startBounds=n;e.bringToFront();if(a.dragging.enabled()){a.dragging.disable()}a.on("mousemove",this._onRotate,this).on("mouseup",this._onRotateEnd,this);e.fire("rotatestart",{bounds:n})},_onRotate:function(t){if(this._rotating){var a=this._map;var e=this._layer;var n=this._startPoint;var i=this._startBounds;var r=t.layerPoint;var s=this._centerPoint;var o=Math.atan2(r.y-s.y,r.x-s.x)-Math.atan2(n.y-s.y,n.x-s.x);while(o>2*Math.PI){o/=2*Math.PI}var l=this._rotateBounds(o,i);this._bounds=l;e.reposition(l[1],l[2],l[0]);this._updateHandlers();e.fire("rotate",{bounds:l})}},_onRotateEnd:function(){if(this._rotating){var t=this._map;var a=this._layer;var e=this._bounds;t.dragging.enable();delete this._rotating;delete this._startPoint;delete this._startBounds;a.fire("rotateend",{bounds:e})}},_createHandlers:function(){var t=this._map;var a=this._bounds;if(t){this._handlers={};this._handlersGroup=this._handlersGroup||(new L.LayerGroup).addTo(t);this._polygon=new L.Polygon(this._bounds,L.extend({pane:this._layer.options.pane},this.options.line)).addTo(this._handlersGroup);if(this.options.scalable){var e=["bottomLeftHandler","topLeftHandler","topRightHandler","bottomRightHandler"];var n=[this.options.bottomLeftHandler,this.options.topLeftHandler,this.options.topRightHandler,this.options.bottomRightHandler];for(var i=0;i<4;i++){this._handlers[e[i]]=new L.ImageOverlayTransform.Handle(a[i],L.extend({name:e[i],pane:this._layer.options.pane},n[i])).on("mousedown",this._onScaleStart,this).addTo(this._handlersGroup)}}if(this.options.rotatable){var r=new L.LatLng((a[0].lat+a[3].lat)/2,(a[0].lng+a[3].lng)/2);var s=new L.LatLng((a[1].lat+a[2].lat)/2,(a[1].lng+a[2].lng)/2);var o=t.layerPointToLatLng(L.ImageOverlayTransform.pointOnLine(t.latLngToLayerPoint(r),t.latLngToLayerPoint(s),20));this._rotationLine=new L.Polyline([s,o],L.extend({pane:this._layer.options.pane},this.options.line)).addTo(this._handlersGroup);this._handlers.rotation=new L.ImageOverlayTransform.Handle(o,L.extend({pane:this._layer.options.pane},this.options.rotationHandler)).on("mousedown",this._onRotateStart,this).addTo(this._handlersGroup)}}},_removeHandlers:function(){if(this._handlersGroup){if(this._polygon){this._handlersGroup.removeLayer(this._polygon);this._polygon=null}if(this._rotationLine){this._handlersGroup.removeLayer(this._rotationLine);this._rotationLine=null}if(this._handlers){for(handlerName in this._handlers){this._handlersGroup.removeLayer(this._handlers[handlerName]);this._handlers[handlerName]=null;delete this._handlers[handlerName]}}}},_updateHandlers:function(){this._removeHandlers();this._createHandlers()},_rotateBounds:function(t,a){a=a||this._bounds;var e=this._map;var n=this._centerPoint;var i=[];var r=Math.sin(t);var s=Math.cos(t);for(var o,l=0;l<4;l++){o=e.latLngToLayerPoint(a[l]);o.x-=n.x;o.y-=n.y;i.push(e.layerPointToLatLng(L.point([n.x+o.x*s-o.y*r,n.y+o.x*r+o.y*s])))}return i},_moveBounds:function(t,a,e){e=e||this._bounds;var n=this._map;var i=[];for(var r,s=0;s<4;s++){r=n.latLngToLayerPoint(e[s]);r.x+=t;r.y+=a;i.push(n.layerPointToLatLng(r))}return i},_calculateCenterPoint:function(){var t=this._map;var a=this._bounds;var e=t.latLngToLayerPoint(a[1]);var n=t.latLngToLayerPoint(a[3]);this._centerPoint=L.point((e.x+n.x)/2,(e.y+n.y)/2)}});L.ImageOverlay.addInitHook(function(){if(this.options.transform){this.transform=new L.Handler.ImageOverlayTransform(this);this.options.interactive=true}});